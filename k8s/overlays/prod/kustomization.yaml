apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: latency-monitor-prod

namespace: latency-monitor

# 引用基础配置
resources:
- ../base

# 副本数配置
replicas:
- name: latency-monitor
  count: 3

# 镜像配置
images:
- name: zunshen/latency-monitor
  newTag: latest

# ConfigMap 补丁
configMapGenerator:
- name: latency-monitor-config
  behavior: merge
  literals:
  - ENVIRONMENT=production
  - LOG_LEVEL=info

# Patch 配置
patchesStrategicMerge:
- deployment-patch.yaml

# HPA 配置
patchesJson6902:
- target:
    group: apps
    version: v1
    kind: Deployment
    name: latency-monitor
  patch: |-
    - op: add
      path: /spec/template/metadata/annotations
      value:
        prometheus.io/scrape: "true"
        prometheus.io/port: "80"
